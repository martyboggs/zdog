<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <script src="node_modules/zdog/dist/zdog.dist.js"></script> -->
	<script src="zdog.dist.js"></script>
	<style>
	body {
		margin: 0;
		background: #431515;
		font-family: sans-serif;
	}
	#fps {
		color: white;
		position: fixed;
		top: 0;
		left: 0;
		padding: 5px;
	}
	#messages {
		color: white;
		position: fixed;
		width: 100%;
		text-align: center;
		font-size: 30px;
		top: 30px;
	}
	</style>
</head>
<body>
<div id="messages"></div>
<div id="fps">
	<div>Health: <span id="health"></span></div>
	<div>Lives: <span id="lives"></span></div>
</div>
<canvas class="zdog-canvas" id="zdog-canvas" width="800" height="600"></canvas>
<script src="game.js"></script>
<script src="objects/effect.js"></script>
<script src="objects/little-man.js"></script>
<script src="objects/bad-guy.js"></script>
<script src="objects/player.js"></script>
<script src="objects/reindeer.js"></script>
<script src="objects/plant.js"></script>
<script src="change-room.js"></script>
<script>
// nonPlayers.littleMans.push(new LittleMan());
// nonPlayers.littleMans[0].model.translate.y = -50;
// nonPlayers.reindeers[0].model.addChild(nonPlayers.littleMans[0].model);
// nonPlayers.reindeers[0].nose.color = '#ff0000';

var player = new Player();
changeRoom(1, 1);

var averageTimePerFrame = 0;
var time = 0;
function animate(timestamp) {
	for (var nonPlayer in nonPlayers) {
		for (var i = 0; i < nonPlayers[nonPlayer].length; i += 1) {
			nonPlayers[nonPlayer][i].update();
		}
	}
	player.update();

	// gravity
	let n;
	for (var nonPlayer in nonPlayers) {
		if (nonPlayer === 'plants') continue;
		for (var i = 0; i < nonPlayers[nonPlayer].length; i += 1) {
			n = nonPlayers[nonPlayer][i];
			if (n.action === 'walking') {
				if (n.model.translate.y < n.y0 - 50) {
					n.action = 'floating-away';
					n.ySpeed = 0;
					if (!score[nonPlayer]) score[nonPlayer] = 0;
					score[nonPlayer] += 1;
				} else if (n.model.translate.y < n.y0) {
					n.ySpeed += 0.5;
					n.model.translate.y += n.ySpeed;
				} else {
					n.model.translate.y = n.y0;
				}
			} else if (n.action === 'floating-away') {
				n.ySpeed -= 0.5;
				n.model.translate.y += n.ySpeed;
			} else if (n.action === 'floating') {
				if (keys[74] === 1) {
					n.action = 'walking';
					n.ySpeed = 0;
				}
			}
		}
	}

	illo.translate.x = -player.model.translate.x;

	illo.updateRenderGraph();
	frame = requestAnimationFrame( animate );
	// document.getElementById('fps').innerHTML = frame / timestamp * 1000;
}

function collision(a, b, distance) {
	if (a.translate.x > b.translate.x - distance && a.translate.x < b.translate.x + distance &&
	a.translate.z > b.translate.z - distance && a.translate.z < b.translate.z + distance) {
		return true;
	}
	return false;
}

animate();
</script>
</body>
</html>
